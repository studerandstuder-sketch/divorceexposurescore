<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Personal Marital Risk Analysis – Marital Risk Analytics LLC</title>
  <style>
    :root {
      --grad-start:#6a2ad9; --grad-end:#2e6bff; --pri:#5e2bb8;
      --bg:#f7f8fc; --card:#fff; --text:#0b1220; --muted:#5b6b87; --border:#e6e9f2;
      --shadow:0 10px 30px rgba(18,24,40,.06);
    }
    body {margin:0;font:16px/1.5 system-ui,Inter,Segoe UI,Roboto,Arial;color:var(--text);background:var(--bg);}
    header {background:linear-gradient(135deg,var(--grad-start),var(--grad-end));color:#fff;padding:18px 0;}
    .wrap{max-width:900px;margin:0 auto;padding:0 16px;}
    .brand{display:flex;align-items:center;gap:12px;}
    .logo-mark{display:flex;gap:6px;align-items:center;}
    .dot{width:9px;height:9px;border-radius:3px;display:inline-block;}
    .d1{background:#6a2ad9}.d2{background:#2a6bff}.d3{background:#e94196}.d4{background:#00c2ff}
    .brand h1{margin:0;font-size:22px;font-weight:800;}
    .brand small{display:block;opacity:.9;font-weight:600;}
    main{padding:40px 16px;}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);padding:32px;max-width:700px;margin:0 auto 32px;}
    h2{font-size:24px;font-weight:800;margin-bottom:16px;}
    label{font-weight:600;display:block;margin-top:16px;}
    input:not([type="radio"]):not([type="checkbox"]), textarea, select{
      width:100%; padding:10px; border:1px solid var(--border); border-radius:8px; margin-top:6px;
    }
    button{background:var(--pri);color:#fff;padding:12px 20px;border:none;border-radius:10px;font-weight:700;margin-top:24px;cursor:pointer;}
    .muted{color:var(--muted);font-size:14px;margin-top:16px;}
    footer{color:#64748b;text-align:center;padding:20px 0;margin-top:40px;}
    fieldset { border: 1px solid var(--border); border-radius: 12px; padding: 12px; margin: 0 0 12px 0; }
    fieldset legend { display:none; }
    label.opt { display:flex; align-items:center; gap:8px; border:1px solid var(--border); border-radius:10px; padding:10px; margin:6px 0; text-align:left;}
    label.opt input[type="radio"]{ margin:0 6px 0 0; }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">
      <div class="logo-mark">
        <span class="dot d1"></span><span class="dot d2"></span><span class="dot d3"></span><span class="dot d4"></span>
      </div>
      <div>
        <h1>Marital Risk Analytics LLC</h1>
        <small>Divorce Exposure Score™</small>
      </div>
    </div>
  </div>
</header>

<main>
  <section class="card">
    <h2>Your Divorce Exposure Score™ Snapshot</h2>
    <p>Based on your 10-question screening, here’s your summary:</p>
    <p><b>Score:</b> <span id="score_val">—</span> / 850
       &nbsp; <b>Exposure:</b> <span id="band_val">—</span>
       &nbsp; <b>Red Flags:</b> <span id="flags_val">—</span></p>

    <div id="phase2_gauge" style="display:flex;align-items:center;gap:16px;margin-top:12px;">
      <div class="score-circle" style="position:relative;display:inline-block;">
        <svg viewBox="0 0 200 200" width="160" height="160" aria-label="Score gauge">
          <circle cx="100" cy="100" r="90" stroke="#eef0f5" stroke-width="20" fill="none"></circle>
          <circle id="p2_progressArc" cx="100" cy="100" r="90" stroke="#5e2bb8" stroke-width="20" fill="none"
                  stroke-dasharray="565.48" stroke-dashoffset="565.48" stroke-linecap="round"
                  transform="rotate(-90 100 100)"></circle>
        </svg>
        <div class="circle-center" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;">
          <div id="p2_gaugeNumber" style="font-size:32px;font-weight:900;">—</div>
          <div id="p2_gaugeBand" style="font-size:13px;font-weight:700;color:#5b6b87;margin-top:2px;">Start</div>
          <div style="font-size:11px;color:#7a889e;margin-top:2px;">300 – 850</div>
        </div>
      </div>
      <div>
        <div id="p2_bandPill"
             style="display:inline-block;background:#eef1ff;color:#2a2f45;border-radius:999px;padding:6px 10px;font-size:12px;font-weight:700;">
          —
        </div>
        <p class="muted" style="margin:8px 0 0;">
          This snapshot helps us focus the review. Like a credit score reflects your credit habits,
          your Divorce Exposure Score™ reflects how your marital finances are set up.
        </p>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>Why Personal Marital Risk Analysis Matters</h2>
    <p>We offer a unique tool to help you clearly understand your financial situation and prepare for potential challenges. Just like a credit score reflects your creditworthiness, the <b>Divorce Exposure Score™</b> reflects how your marital finances are set up.</p>
    <p class="muted">⚠️ Important: This assessment is informational only and not legal, financial, or tax advice.</p>
  </section>

  <section class="card">
<form name="phase2-analysis" method="POST" action="/success.html" netlify netlify-honeypot="bot-field">
      <input type="hidden" name="form-name" value="phase2-analysis">
      <p style="display:none"><label>Don’t fill this out if you’re human: <input name="bot-field"></label></p>

      <!-- Hidden score data -->
      <input type="hidden" name="score" id="score_hidden">
      <input type="hidden" name="exposure_band" id="band_hidden">
      <input type="hidden" name="red_flags" id="flags_hidden">

      <!-- Contact info -->
      <label for="full_name">Full Name</label>
      <input id="full_name" name="full_name" type="text" placeholder="Your name" required>

      <label for="email">Email (to receive your report)</label>
      <input id="email" name="email" type="email" placeholder="you@email.com" required>

      <!-- Clarifier questions -->
      <div id="followups_container" class="card" style="margin-top:16px;">
        <h3 style="margin-top:0;">Answer the following tailored questions</h3>
        <p class="muted" style="margin:6px 0 14px;">
          These quick questions are tailored to your previous answers.
        </p>
        <div id="followups_body"></div>
      </div>

<button type="submit" class="btn primary">Get your report</button>
    </form>
  </section>
</main>

<footer>
  Informational diagnostic only — no legal, tax, or financial advice.
</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // ---- Helpers ----
  const pick = (a,b) => localStorage.getItem(a) || localStorage.getItem(b) || "—";
  const setText = (id,val)=>{ const el=document.getElementById(id); if(el) el.textContent=val; };
  const setVal  = (id,val)=>{ const el=document.getElementById(id); if(el) el.value=val; };

  // ---- Load Snapshot values ----
  const scoreStr = pick("score","des_score");
  const bandStr  = pick("band","des_band");
  let flagsStr = pick("flags","des_flags");

  setText("score_val", scoreStr);
  setText("band_val",  bandStr);
  setText("flags_val", flagsStr);
  setVal("score_hidden", scoreStr);
  setVal("band_hidden",  bandStr);
  setVal("flags_hidden", flagsStr);

  // ---- Gauge ----
  const score = Math.max(300, Math.min(850, Number(scoreStr) || 300));
  const bandLabel = s => s >= 750 ? "Low" : (s >= 600 ? "Moderate" : "High");
  const bandColor = s => s >= 750 ? "#0f9d58" : (s >= 600 ? "#fb8c00" : "#d93025");
  const maxCirc = 565.48;
  const percent = (score - 300) / 550;
  const offset  = maxCirc - maxCirc * Math.max(0, Math.min(1, percent));
  const arc = document.getElementById("p2_progressArc");
  if (arc) { arc.style.strokeDashoffset = String(offset); arc.style.stroke = bandColor(score); }
  setText("p2_gaugeNumber", String(score));
  const band = bandLabel(score) + " exposure";
  setText("p2_gaugeBand", band);
  const pill = document.getElementById("p2_bandPill");
  if (pill) { pill.textContent = band; pill.style.border = "1px solid " + bandColor(score) + "22"; }

  // ---- Load Phase 1 answers ----
  let answers = {};
  try { answers = JSON.parse(localStorage.getItem("des_answers") || "{}"); } catch(e){ answers = {}; }

  // ---- RULES for red/pos (used only to recompute flags for Snapshot consistency) ----
  const RULES = {
    prenup:  v=> v===100 ? "pos":"red",
    home:    v=> (v===100 || v===70) ? "pos":"red",
    rentals: v=> v===100 ? "pos":"red",
    k1:      v=> (v===100 || v===70) ? "pos":"red",
    crypto:  v=> (v===100 || v===70) ? "pos":"red",
    retire:  v=> v===100 ? "pos":"red",
    banking: v=> v===100 ? "pos":"red",
    bizuse:  v=> (v===100 || v===50) ? "pos":"red",
    debt:    v=> (v===100 || v===70) ? "pos":"red",
    tax:     v=> (v===100 || v===70) ? "pos":"red"
  };

  // ---- Recompute red flags from Phase 1 for Snapshot consistency (10 categories) ----
  (function recomputeFlags(){
    try{
      const ALL_KEYS = ["prenup","home","rentals","k1","crypto","retire","banking","bizuse","debt","tax"];
      let redFlags = 0;
      ALL_KEYS.forEach(k => {
        const a = answers[k];
        if (!a) return;
        const kind = RULES[k](Number(a.value));
        if (kind === "red") redFlags++;
      });
      flagsStr = String(redFlags);
      setText("flags_val", flagsStr);
      setVal("flags_hidden", flagsStr);
      localStorage.setItem("des_flags", flagsStr);
      localStorage.setItem("flags", flagsStr);
    }catch(e){ console.error("Flag recompute failed:", e); }
  })();

  // ---- Clarifier sets (friendly, short wording) ----
  const FUPS = {
    prenup: {
      "Prenup/postnup fits where we live now": {
        question: "About your pre-/postnup — When did you last update it with a lawyer?",
        options: ["Within past 2 years","3–5 years ago","Over 5 years ago","Never reviewed since signing"]
      },
      "Prenup exists, not updated after moving": {
        question: "Since signing your pre-/postnup — Did you move to another state or country?",
        options: ["Same state","Different state","Different country","Multiple moves"]
      },
      "No prenup; community-property/cross-border": {
        question: "Concerning your residence — Do you live in a community-property place right now?",
        options: ["Yes – US community-property state","Yes – international community-property","No – equitable distribution","Unsure"]
      },
      "No prenup; moved a lot, unclear law": {
        question: "About your lifestyle — How often do you usually move homes?",
        options: ["Every 1–2 years","Every 3–5 years","Rarely","Currently in transition"]
      }
    },
    home: {
      "We rent, no house to split": {
        question: "About your primary home — Whose name is on the lease or title?",
        options: ["Only mine","Joint with spouse","Spouse only","Month-to-month / handshake"]
      },
      "Title only in my name/entity": {
        question: "How’s your primary home financed — cash, mortgage in your name, or joint?",
        options: ["Paid in cash","Mortgage only in my name","Mortgage co-signed by spouse","Title in LLC or trust"]
      },
      "Joint title but I fully pay": {
        question: "If you pay most of your primary home — Why did you still put it in both names?",
        options: ["Bank/lender required it","Estate planning","Didn’t think about implications","Tax reasons"]
      },
      "Joint title and both pay": {
        question: "How do you split the monthly primary housing costs?",
        options: ["50/50","I pay majority","Spouse pays majority","It varies month to month"]
      }
    },
    rentals: {
      "All properties in my name/entity": {
        question: "Concerning your rental properties — Where does the rent money actually go?",
        options: ["Direct to my account","Flow through LLC","Split with spouse informally","Reinvested only"]
      },
      "Some mine, some joint": {
        question: "For rental properties you own together — How are they titled?",
        options: ["Joint tenancy","Tenants in common","Community property","Partnership entity"]
      },
      "Most are joint": {
        question: "Who manages your rental properties day-to-day?",
        options: ["I manage","Spouse manages","We share management","Outsourced to property manager"]
      },
      "Everything joint": {
        question: "How were the rental properties funded — your money, spouse’s, or joint funds?",
        options: ["My savings","Spouse savings","Joint savings","Mostly mortgages/debt"]
      }
    },
    k1: {
      "Shares only in my name/entity": {
        question: "About your companies — Do the papers mention divorce or separation rules?",
        options: ["Yes – airtight","Yes – but outdated","No","Unsure"]
      },
      "Some joint but clear records": {
        question: "Concerning payouts — How are business profits really split?",
        options: ["Documented formally","Informal transfers","Paid to joint account","Mixed methods"]
      },
      "Several joint holdings": {
        question: "About ownership — How much of the business does your spouse own?",
        options: ["<25%","25–49%","50%",">50%"]
      },
      "Mostly joint; spouse on papers": {
        question: "What’s your spouse’s actual role in the business?",
        options: ["Passive/signature only","Active partner","Day-to-day operator","Co-founder"]
      }
    },
    crypto: {
      "All wallets/exchanges in my name": {
        question: "About your crypto — Where do you keep the keys?",
        options: ["Hardware wallet","Exchange login","Multi-sig","Spouse knows keys"]
      },
      "Some joint but tracked": {
        question: "Concerning reporting — How do you declare crypto gains/losses?",
        options: ["Each files separately","Joint filing","Not reported consistently","Unsure"]
      },
      "Most shared": {
        question: "About trading — Who usually makes the crypto trades?",
        options: ["I do","Spouse does","Both equally","Automated"]
      },
      "Everything joint or not tracked": {
        question: "About records — Where do you keep track of crypto activity?",
        options: ["Exchange history only","Spreadsheet","None","I don’t know"]
      }
    },
    retire: {
      "All in my name": {
        question: "Concerning your retirement accounts — Did they start before or after marriage?",
        options: ["Pre-marriage","After marriage","Mix of both","Unsure"]
      },
      "Separate checking, joint savings": {
        question: "About joint savings — What share of your investments sit there?",
        options: ["<25%","25–50%",">50%","Unsure"]
      },
      "Some joint": {
        question: "Concerning contributions to retirement — Who puts money in?",
        options: ["I fund","Spouse funds","Both equally","Mixed contributions"]
      },
      "All joint": {
        question: "Why are all your retirement/investments joint?",
        options: ["Convenience","Estate planning","Tax advice","No specific reason"]
      }
    },
    banking: {
      "Separate accounts": {
        question: "About your bills — Who pays the household expenses?",
        options: ["I pay directly","Spouse pays directly","Each pays own","Shared card transfer"]
      },
      "Some shared spending": {
        question: "Concerning joint bank accounts — What kind do you use?",
        options: ["Joint checking","Joint credit card","Shared savings only","Other"]
      },
      "Most income/bills joint": {
        question: "Do you actually track who pays what each month?",
        options: ["Formal records","Informal tracking","None","Spouse handles it"]
      },
      "Everything joint, not tracked": {
        question: "About big buys — How do you decide when making large purchases?",
        options: ["Joint approval","One decides","Either spends freely","Credit-driven only"]
      }
    },
    tax: {
      "File separately; full disclosure": {
        question: "Concerning your tax reporting — Who does it each year?",
        options: ["CPA annually","Tax software","Self-prepared","Spouse prepares"]
      },
      "File jointly; clear returns": {
        question: "About record-keeping — Who keeps the tax returns?",
        options: ["I do","Spouse","Shared folder","Accountant only"]
      },
      "Joint returns but with gaps": {
        question: "When filing your taxes jointly — What’s usually missing?",
        options: ["Missing income docs","Missing deductions","Overseas reporting","Unsure"]
      },
      "Messy/incomplete returns": {
        question: "What’s your biggest headache with taxes?",
        options: ["Lost paperwork","Unfiled years","Conflicting info","IRS/tax authority notices"]
      }
    }
  };

  const FUP_KEYS = ["prenup","home","rentals","k1","crypto","retire","banking","tax"];

  // ---- Render Clarifiers ----
  const followBody = document.getElementById("followups_body");
  const form = document.forms["phase2-analysis"];

  function radio(name, value, label, required) {
    const wrap = document.createElement("label");
    wrap.className = "opt";
    const input = document.createElement("input");
    input.type = "radio"; input.name = name; input.value = value;
    if (required) input.required = true;
    const span = document.createElement("span"); span.textContent = label;
    wrap.appendChild(input); wrap.appendChild(span);
    return wrap;
  }

  if (followBody && form) {
    FUP_KEYS.forEach(key => {
      const a = answers[key]; if (!a || !a.label) return;
      const cfg = (FUPS[key] || {})[a.label]; if (!cfg) return;

      const fs = document.createElement("fieldset");
      const q = document.createElement("div");
      q.style.fontWeight = "600"; q.style.margin = "2px 0 8px"; q.textContent = cfg.question;
      fs.appendChild(q);

      const inputName = "q_" + key;
      cfg.options.slice(0,4).forEach((opt, idx) => {
        fs.appendChild(radio(inputName, String.fromCharCode(65+idx), opt, idx===0));
      });

      const hidden = document.createElement("input");
      hidden.type = "hidden"; hidden.name = "orig_" + key; hidden.value = a.label;
      fs.appendChild(hidden);

      followBody.appendChild(fs);
    });
  }

  // ---- Persist name/email + clarifiers on submit ----
  if (form) {
    form.addEventListener("submit", () => {
      const followups = {};
      FUP_KEYS.forEach(key => {
        const name = "q_" + key;
        const input = form.querySelector(`input[name="${name}"]:checked`);
        if (!input) return;
        const labelEl = input.parentElement?.querySelector("span");
        followups[key] = { choice: input.value, label: (labelEl ? labelEl.textContent : "").trim() };
      });
      localStorage.setItem("des_followups", JSON.stringify(followups));
      try {
        localStorage.setItem("full_name", (form.full_name?.value || "").trim());
        localStorage.setItem("email", (form.email?.value || "").trim());
      } catch(e) { console.error("Could not persist name/email:", e); }
    });
  }
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.forms['phase2-analysis'];
  if (!form) return;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const fd = new FormData(form);

    // Pull values (fallback to localStorage)
    const fullName = fd.get('full_name') || localStorage.getItem('full_name') || '';
    const email    = fd.get('email')     || localStorage.getItem('email')     || '';
    const score    = fd.get('score')     || localStorage.getItem('des_score') || '';
    const band     = fd.get('exposure_band') || localStorage.getItem('des_band')  || '';
    const flags    = fd.get('red_flags')     || localStorage.getItem('des_flags') || '';

    // Persist for report.html
    localStorage.setItem('full_name', fullName);
    localStorage.setItem('email', email);
    localStorage.setItem('des_score', score);
    localStorage.setItem('des_band', band);
    localStorage.setItem('des_flags', flags);

    // Ensure Netlify sees the form name in the payload
    if (!fd.get('form-name')) fd.set('form-name', 'phase2-analysis');

    // Background submit to Netlify Forms
    try {
      await fetch('/', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: new URLSearchParams(fd).toString()
      });
    } catch (err) {
      console.warn('Background submit failed; continuing to report.html', err);
    }

    // Navigate to report (GET) so it always loads
    window.location.href = 'report.html';
  });
});
</script>

</body>
</html>
